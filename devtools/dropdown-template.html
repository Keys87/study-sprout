<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="shortcut icon" href="public/logo-trans.png" type="image/x-icon" />
  <link rel="stylesheet" href="out.css" />
  <title>Study Sprout</title>
</head>

<body class="p-0 m-0 flex flex-col w-screen h-screen text-main font-primary-text bg-primary-bg">
  <nav class=" w-screen py-8 flex justify-center items-center flex-row bg-primary-bg shadow-xl shadow-shadow">

    <div class="flex-auto ms-2">
      <a href="index.html">
        <img src="public/logo-trans.png" alt="Logo/Home Button" class="h-16 w-auto object-contain" />
      </a>
    </div>
    <div class="flex flex-auto justify-center">
      <a href="rss.html" class="p-1 text-main font-primary-text underline hover:font-bold">Resources</a>
      <a href="opportunities.html" class="p-1 text-main font-primary-text underline hover:font-bold">Opportunities</a>
      <a href="contact.html" class="p-1 text-main font-primary-text underline hover:font-bold">Contact Us</a>
    </div>

    <div class="flex-auto h-full"></div>
  </nav>

  <section class="flex flex-row mt-6 w-screen justify-center">
    <!-- ========================================== -->
    <!-- COMPONENT START: Nested Dropdown System    -->
    <!-- ========================================== -->

    <div class="relative inline-block text-left" id="dropdown-parent">
      <!-- Trigger A: The Main Subject Select Button -->
      <button type="button" id="dropdown-button"
        class="inline-flex items-center justify-between gap-3 text-main text-2xl w-36 md:w-56 md:h-20 lg:w-72 lg:h-24 p-6 rounded-2xl shadow-lg transition transform bg-linear-to-r from-primary to-primary-var1 hover:shadow-2xl hover:scale-105 hover:from-tertiary-var1 hover:to-tertiary-var2">
        <span class="truncate">Select Subject</span>
        <svg class="w-6 h-6 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
        </svg>
      </button>

      <!-- Dropdown A: The List of Subjects -->
      <div id="dropdown-child"
        class="hidden absolute left-0 z-10 mt-4 w-72 origin-top-left rounded-xl shadow-2xl ring-1 ring-primary-text bg-white max-h-[80vh] overflow-y-auto">
        <div class="flex flex-col p-2 gap-2 w-full" id="subjects-list">
          <!-- Subjects (Dropdown B triggers) will be injected here -->
        </div>
      </div>
    </div>

    <!-- ========================================== -->
    <!-- LOGIC START                                -->
    <!-- ========================================== -->

    <script type="module">
      import { subjects } from "../public/subjects.js";
      import { rss } from "../public/rss.js";
      import { renderDesc, renderLinks } from "../scripts/rss-desc.js";

      // --- 1. Main Dropdown Manager (Dropdown A) ---
      const mainDropdownManager = (() => {
        const init = () => {
          const btn = document.querySelector('#dropdown-button');
          const menu = document.querySelector('#dropdown-child');
          if (!btn || !menu) return;

          // Toggle Main Menu
          btn.addEventListener('click', (e) => {
            e.stopPropagation();
            menu.classList.toggle('hidden');
          });

          // Close when clicking outside
          document.addEventListener('click', (e) => {
            if (!menu.contains(e.target) && !btn.contains(e.target)) {
              menu.classList.add('hidden');
            }
          });
        };
        return { init };
      })();

      // --- 2. HTML Generators ---

      // Generates the Resource Item (Inside Dropdown B)
      const createResourceItem = (resourceName, resourceUrl) => {
        // UPDATED: Now returns an <a> tag instead of a <button>
        return `
      <a 
        href="${resourceUrl}"
        target="_blank"
        rel="noopener noreferrer"
        data-resource="${resourceName}"
        class="resource-link w-full flex items-center justify-start gap-3 px-4 py-3 text-sm font-medium bg-linear-to-r from-primary to-primary-var1 hover:from-tertiary-var1 hover:to-tertiary-var2 rounded-lg transition-colors text-left no-underline text-main"
      >
        <svg class="w-4 h-4 shrink-0 opacity-60" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path>
        </svg>
        <span class="truncate">${resourceName}</span>
      </a>
    `;
      };

      // Generates the Subject Dropdown (Dropdown B)
      const createSubjectDropdown = (subject, index) => {
        return `
        <div class="relative w-full group" id="subject-wrapper-${index}">
            <!-- Trigger B -->
            <button type="button" id="subject-btn-${index}" class="w-full flex items-center justify-between gap-3 px-4 py-3 bg-linear-to-r from-primary to-primary-var1 hover:from-tertiary-var1 hover:to-tertiary-var2 rounded-lg transition-colors text-left">
                <span class="truncate font-medium">${subject}</span>
                <svg class="w-4 h-4 shrink-0 opacity-70" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
            </button>

            <!-- Dropdown B Content (Resources) -->
            <div id="subject-menu-${index}" class="hidden w-full mt-2 pl-4 flex-col gap-1">
               <div id="resources-list-${index}" class="flex flex-col gap-2 border-l-2 border-gray-200 pl-2">
                  <!-- Resources injected here -->
               </div>
            </div>
        </div>
    `;
      };

      // --- 3. Render Logic ---
      const parentList = document.getElementById("subjects-list");

      // Loop through all IBDP Subjects
      subjects.IBDP.forEach((element, i) => {
        const subjectName = element.subject;

        // A. Inject the Subject Dropdown HTML
        parentList.insertAdjacentHTML("beforeend", createSubjectDropdown(subjectName, i));

        const subjectBtn = document.getElementById(`subject-btn-${i}`);
        const subjectMenu = document.getElementById(`subject-menu-${i}`);
        const resourcesList = document.getElementById(`resources-list-${i}`);

        // C. Populate Dropdown B with Resources
        const subjectResources = rss[subjectName];

        if (subjectResources && subjectResources.length > 0) {
          subjectResources.forEach((res) => {
            const resourceName = res[0];
            const resourceUrl = res[1];
            resourcesList.insertAdjacentHTML("beforeend", createResourceItem(resourceName, resourceUrl));
          });
        } else {
          resourcesList.innerHTML = `<span class="text-xs text-gray-400 p-2">No resources found</span>`;
        }

        // D. Add Logic to Toggle Dropdown B
        subjectBtn.addEventListener('click', (e) => {
          e.stopPropagation();

          document.querySelectorAll('[id^="subject-menu-"]').forEach(el => {
            if (el.id !== `subject-menu-${i}`) el.classList.add('hidden');
          });

          subjectMenu.classList.toggle('hidden');
        });

        // E. Add Logic to Resource Links
        const resourceLinks = resourcesList.querySelectorAll('.resource-link');
        resourceLinks.forEach(link => {
          link.addEventListener('click', function (e) {
            // We don't prevent default because it's a link now, 
            // but we still want to update app state for tracking
            const resourceName = this.dataset.resource;

            window.appState = {
              "currentSubject": subjectName,
              "currentResource": resourceName
            };

            try {
              renderDesc();
              renderLinks();
            } catch (error) {
              console.warn("Render functions failed:", error);
            }
          });
        });
      });

      primary - textDropdownManager.init();

    </script>
  </section>
</body>



</html>